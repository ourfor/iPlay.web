"use strict";(self.webpackChunkiplay=self.webpackChunkiplay||[]).push([[193],{3193:function(e,t,a){a.r(t),a.d(t,{SSAParser:function(){return g},default:function(){return N}});var s=a(1413),i=a(4165),r=a(5861),n=a(5671),l=a(3144),c=a(4942),o=a(3621),u=/^Format:[\s\t]*/,h=/^Style:[\s\t]*/,p=/^Dialogue:[\s\t]*/,f=/[\s\t]*,[\s\t]*/,v=/\{[^}]+\}/g,d=/\\N/g,k=/^\[(.*)[\s\t]?Styles\]$/,b=/^\[(.*)[\s\t]?Events\]$/,g=function(){function e(){(0,n.Z)(this,e),(0,c.Z)(this,"f",void 0),(0,c.Z)(this,"O",0),(0,c.Z)(this,"a",null),(0,c.Z)(this,"j",[]),(0,c.Z)(this,"k",[]),(0,c.Z)(this,"N",null),(0,c.Z)(this,"d",void 0),(0,c.Z)(this,"P",{})}return(0,l.Z)(e,[{key:"init",value:function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.f=t,!t.errors){e.next=5;break}return e.next=4,a.e(653).then(a.bind(a,8653));case 4:this.d=e.sent.ParseErrorBuilder;case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"parse",value:function(e,t){if(this.O)switch(this.O){case 1:if(""===e)this.O=0;else if(h.test(e))if(this.N){var a=e.replace(h,"").split(f);this.S(a)}else{var s;this.e(null===(s=this.d)||void 0===s?void 0:s.T("Style",t))}else u.test(e)?this.N=e.replace(u,"").split(f):b.test(e)&&(this.N=null,this.O=2);break;case 2:if(""===e)this.Q();else if(p.test(e))if(this.Q(),this.N){var i=e.replace(p,"").split(f),r=this.U(i,t);r&&(this.a=r)}else{var n;this.e(null===(n=this.d)||void 0===n?void 0:n.T("Dialogue",t))}else this.a?this.a.text+="\n"+e.replace(v,"").replace(d,"\n"):u.test(e)?this.N=e.replace(u,"").split(f):k.test(e)?(this.N=null,this.O=1):b.test(e)&&(this.N=null)}else""===e||(k.test(e)?(this.N=null,this.O=1):b.test(e)&&(this.N=null,this.O=2))}},{key:"done",value:function(){return{metadata:{},cues:this.j,regions:[],errors:this.k}}},{key:"Q",value:function(){var e,t;this.a&&(this.j.push(this.a),null===(e=(t=this.f).onCue)||void 0===e||e.call(t,this.a),this.a=null)}},{key:"S",value:function(e){for(var t,a,s,i,r="Default",n={},l="center",c="bottom",o=1.2,u=3,h=[],p=0;p<this.N.length;p++){var f=this.N[p],v=e[p];switch(f){case"Name":r=v;break;case"Fontname":n["font-family"]=v;break;case"Fontsize":n["font-size"]="calc(".concat(v," / var(--overlay-height))");break;case"PrimaryColour":var d=y(v);d&&(n["--cue-color"]=d);break;case"BorderStyle":u=parseInt(v,10);break;case"BackColour":i=y(v);break;case"OutlineColour":var k=y(v);k&&(s=k);break;case"Bold":parseInt(v)&&(n["font-weight"]="bold");break;case"Italic":parseInt(v)&&(n["font-style"]="italic");break;case"Underline":parseInt(v)&&(n["text-decoration"]="underline");break;case"StrikeOut":parseInt(v)&&(n["text-decoration"]="line-through");break;case"Spacing":n["letter-spacing"]=v+"px";break;case"AlphaLevel":n.opacity=parseFloat(v);break;case"ScaleX":h.push("scaleX(".concat(parseFloat(v)/100,")"));break;case"ScaleY":h.push("scaleY(".concat(parseFloat(v)/100,")"));break;case"Angle":h.push("rotate(".concat(v,"deg)"));break;case"Shadow":o=1.2*parseInt(v,10);break;case"MarginL":n["--cue-width"]="auto",n["--cue-left"]=parseFloat(v)+"px";break;case"MarginR":n["--cue-width"]="auto",n["--cue-right"]=parseFloat(v)+"px";break;case"MarginV":a=parseFloat(v);break;case"Outline":t=parseInt(v,10);break;case"Alignment":var b=parseInt(v,10);switch(b>=4&&(c=b>=7?"top":"center"),b%3){case 1:l="start";break;case 2:l="center";break;case 3:l="end"}}}if(n.R=c,n["--cue-white-space"]="normal",n["--cue-line-height"]="normal",n["--cue-text-align"]=l,"center"===c?(n["--cue-top"]="50%",h.push("translateY(-50%)")):n["--cue-".concat(c)]=(a||0)+"px",1===u&&(n["--cue-padding-y"]="0"),(1===u||i)&&(n["--cue-bg-color"]=1===u?"none":i),3===u&&s&&(n["--cue-outline"]="".concat(t,"px solid ").concat(s)),1===u&&"number"===typeof t){var g,N=null!==(g=i)&&void 0!==g?g:"#000";n["--cue-text-shadow"]=[s&&x(1.2*t,1.2*o,s),s?x(t*(t/2),o*(t/2),N):x(t,o,N)].filter(Boolean).join(", ")}h.length&&(n["--cue-transform"]=h.join(" ")),this.P[r]=n}},{key:"U",value:function(e,t){var a=this.V(e),i=this.o(a.Start,a.End,t);if(i){var r=new o.b(i[0],i[1],""),n=(0,s.Z)({},this.P[a.Style]||{}),l=a.Name?"<v ".concat(a.Name,">"):"",c=n.R,u=a.MarginL&&parseFloat(a.MarginL),h=a.MarginR&&parseFloat(a.MarginR),p=a.MarginV&&parseFloat(a.MarginV);return u&&(n["--cue-width"]="auto",n["--cue-left"]=u+"px"),h&&(n["--cue-width"]="auto",n["--cue-right"]=h+"px"),p&&"center"!==c&&(n["--cue-".concat(c)]=p+"px"),r.text=l+e.slice(this.N.length-1).join(", ").replace(v,"").replace(d,"\n"),delete n.R,Object.keys(n).length&&(r.style=n),r}}},{key:"V",value:function(e){for(var t={},a=0;a<this.N.length;a++)t[this.N[a]]=e[a];return t}},{key:"o",value:function(e,t,a){var s,i,r,n=(0,o.p)(e),l=(0,o.p)(t);if(null!==n&&null!==l&&l>n)return[n,l];null===n&&this.e(null===(s=this.d)||void 0===s?void 0:s.q(e,a)),null===l&&this.e(null===(i=this.d)||void 0===i?void 0:i.r(t,a)),null!=n&&null!==l&&l>n&&this.e(null===(r=this.d)||void 0===r?void 0:r.s(n,l,a))}},{key:"e",value:function(e){if(e){if(this.k.push(e),this.f.strict)throw this.f.cancel(),e;var t,a;null===(t=(a=this.f).onError)||void 0===t||t.call(a,e)}}}]),e}();function y(e){var t=parseInt(e.replace("&H",""),16);return t>=0?"rgba("+[255&t,t>>8&255,t>>16&255,(t>>24&255^255)/255].join(",")+")":null}function x(e,t,a){for(var s=Math.ceil(2*Math.PI*e),i="",r=0;r<s;r++){var n=2*Math.PI*r/s;i+=e*Math.cos(n)+"px "+t*Math.sin(n)+"px 0 "+a+(r==s-1?"":",")}return i}function N(){return new g}}}]);